FIRRTL version 1.2.0
circuit ReturnAddressStack :
  module ReturnAddressStack :
    input clock : Clock
    input reset : UInt<1>
    input io_push : UInt<1> @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 44:14]
    input io_push_addr : UInt<32> @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 44:14]
    input io_pop : UInt<1> @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 44:14]
    output io_predicted_addr : UInt<32> @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 44:14]
    output io_valid : UInt<1> @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 44:14]
    input io_restore : UInt<1> @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 44:14]
    input io_restore_addr : UInt<32> @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 44:14]
    input io_restore_valid : UInt<1> @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 44:14]

    reg stack_0 : UInt<32>, clock with :
      reset => (UInt<1>("h0"), stack_0) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 64:18]
    reg stack_1 : UInt<32>, clock with :
      reset => (UInt<1>("h0"), stack_1) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 64:18]
    reg stack_2 : UInt<32>, clock with :
      reset => (UInt<1>("h0"), stack_2) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 64:18]
    reg stack_3 : UInt<32>, clock with :
      reset => (UInt<1>("h0"), stack_3) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 64:18]
    reg sp : UInt<3>, clock with :
      reset => (UInt<1>("h0"), sp) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 65:22]
    node _tos_index_T = sub(sp, UInt<1>("h1")) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 68:23]
    node _tos_index_T_1 = tail(_tos_index_T, 1) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 68:23]
    node tos_index = bits(_tos_index_T_1, 1, 0) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 68:29]
    node _io_valid_T = gt(sp, UInt<1>("h0")) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 71:27]
    node _GEN_0 = validif(eq(UInt<1>("h0"), tos_index), stack_0) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 72:{27,27}]
    node _GEN_1 = mux(eq(UInt<1>("h1"), tos_index), stack_1, _GEN_0) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 72:{27,27}]
    node _GEN_2 = mux(eq(UInt<2>("h2"), tos_index), stack_2, _GEN_1) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 72:{27,27}]
    node _GEN_3 = mux(eq(UInt<2>("h3"), tos_index), stack_3, _GEN_2) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 72:{27,27}]
    node _stack_tos_index = _GEN_3 @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 72:27]
    node _io_predicted_addr_T = mux(io_valid, _stack_tos_index, UInt<1>("h0")) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 72:27]
    node _T = lt(sp, UInt<3>("h4")) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 77:33]
    node _T_1 = and(io_restore_valid, _T) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 77:27]
    node _T_2 = bits(sp, 1, 0) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 78:15]
    node _stack_T_2 = io_restore_addr @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 78:{41,41}]
    node _GEN_4 = mux(eq(UInt<1>("h0"), _T_2), _stack_T_2, stack_0) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 64:18 78:{41,41}]
    node _GEN_5 = mux(eq(UInt<1>("h1"), _T_2), _stack_T_2, stack_1) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 64:18 78:{41,41}]
    node _GEN_6 = mux(eq(UInt<2>("h2"), _T_2), _stack_T_2, stack_2) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 64:18 78:{41,41}]
    node _GEN_7 = mux(eq(UInt<2>("h3"), _T_2), _stack_T_2, stack_3) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 64:18 78:{41,41}]
    node _sp_T = add(sp, UInt<1>("h1")) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 79:47]
    node _sp_T_1 = tail(_sp_T, 1) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 79:47]
    node _GEN_8 = mux(_T_1, _GEN_4, stack_0) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 64:18 77:44]
    node _GEN_9 = mux(_T_1, _GEN_5, stack_1) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 64:18 77:44]
    node _GEN_10 = mux(_T_1, _GEN_6, stack_2) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 64:18 77:44]
    node _GEN_11 = mux(_T_1, _GEN_7, stack_3) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 64:18 77:44]
    node _GEN_12 = mux(_T_1, _sp_T_1, sp) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 65:22 77:44 79:41]
    node _T_3 = and(io_push, io_pop) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 81:22]
    node _stack_tos_index_0 = io_push_addr @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 84:{22,22}]
    node _GEN_13 = mux(eq(UInt<1>("h0"), tos_index), _stack_tos_index_0, stack_0) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 64:18 84:{22,22}]
    node _GEN_14 = mux(eq(UInt<1>("h1"), tos_index), _stack_tos_index_0, stack_1) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 64:18 84:{22,22}]
    node _GEN_15 = mux(eq(UInt<2>("h2"), tos_index), _stack_tos_index_0, stack_2) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 64:18 84:{22,22}]
    node _GEN_16 = mux(eq(UInt<2>("h3"), tos_index), _stack_tos_index_0, stack_3) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 64:18 84:{22,22}]
    node _T_4 = lt(sp, UInt<3>("h4")) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 87:13]
    node _T_5 = bits(sp, 1, 0) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 88:15]
    node _stack_T_5 = io_push_addr @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 88:{41,41}]
    node _GEN_17 = mux(eq(UInt<1>("h0"), _T_5), _stack_T_5, stack_0) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 64:18 88:{41,41}]
    node _GEN_18 = mux(eq(UInt<1>("h1"), _T_5), _stack_T_5, stack_1) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 64:18 88:{41,41}]
    node _GEN_19 = mux(eq(UInt<2>("h2"), _T_5), _stack_T_5, stack_2) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 64:18 88:{41,41}]
    node _GEN_20 = mux(eq(UInt<2>("h3"), _T_5), _stack_T_5, stack_3) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 64:18 88:{41,41}]
    node _sp_T_2 = add(sp, UInt<1>("h1")) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 89:47]
    node _sp_T_3 = tail(_sp_T_2, 1) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 89:47]
    node _GEN_21 = mux(_T_4, _GEN_17, stack_1) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 87:24 93:18]
    node _GEN_22 = mux(_T_4, _GEN_18, stack_2) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 87:24 93:18]
    node _GEN_23 = mux(_T_4, _GEN_19, stack_3) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 87:24 93:18]
    node _GEN_24 = mux(_T_4, _GEN_20, io_push_addr) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 87:24 95:24]
    node _GEN_25 = mux(_T_4, _sp_T_3, sp) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 65:22 87:24 89:41]
    node _T_6 = gt(sp, UInt<1>("h0")) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 100:13]
    node _sp_T_4 = sub(sp, UInt<1>("h1")) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 101:16]
    node _sp_T_5 = tail(_sp_T_4, 1) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 101:16]
    node _GEN_26 = mux(_T_6, _sp_T_5, sp) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 100:20 101:10 65:22]
    node _GEN_27 = mux(io_pop, _GEN_26, sp) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 65:22 98:22]
    node _GEN_28 = mux(io_push, _GEN_21, stack_0) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 64:18 85:23]
    node _GEN_29 = mux(io_push, _GEN_22, stack_1) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 64:18 85:23]
    node _GEN_30 = mux(io_push, _GEN_23, stack_2) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 64:18 85:23]
    node _GEN_31 = mux(io_push, _GEN_24, stack_3) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 64:18 85:23]
    node _GEN_32 = mux(io_push, _GEN_25, _GEN_27) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 85:23]
    node _GEN_33 = mux(_T_3, _GEN_13, _GEN_28) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 81:33]
    node _GEN_34 = mux(_T_3, _GEN_14, _GEN_29) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 81:33]
    node _GEN_35 = mux(_T_3, _GEN_15, _GEN_30) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 81:33]
    node _GEN_36 = mux(_T_3, _GEN_16, _GEN_31) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 81:33]
    node _GEN_37 = mux(_T_3, sp, _GEN_32) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 65:22 81:33]
    node _GEN_38 = mux(io_restore, _GEN_8, _GEN_33) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 75:20]
    node _GEN_39 = mux(io_restore, _GEN_9, _GEN_34) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 75:20]
    node _GEN_40 = mux(io_restore, _GEN_10, _GEN_35) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 75:20]
    node _GEN_41 = mux(io_restore, _GEN_11, _GEN_36) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 75:20]
    node _GEN_42 = mux(io_restore, _GEN_12, _GEN_37) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 75:20]
    io_predicted_addr <= _io_predicted_addr_T @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 72:21]
    io_valid <= _io_valid_T @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 71:21]
    stack_0 <= _GEN_38
    stack_1 <= _GEN_39
    stack_2 <= _GEN_40
    stack_3 <= _GEN_41
    sp <= mux(reset, UInt<3>("h0"), _GEN_42) @[4-soc/src/main/scala/riscv/core/ReturnAddressStack.scala 65:{22,22}]
